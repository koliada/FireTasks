if(window.List){window.List.view=(function(e){var t={LBL_CREATE:"Create",LBL_UPDATE:"Rename"},r={progressBar:e("#progress-lists"),btnSync:e("#btn-sync-lists"),actionChooser:e("#list-actions"),btnNewList:e("#btn-new-list"),btnRenameList:e("#btn-rename-list"),btnDeleteList:e("#btn-delete-list"),list:e('section[data-type="sidebar"]').find("nav ul"),form:e("#list-form"),btnBack:e("#btn-list-form-back"),btnOk:e("#btn-list-form-ok")},j={};function g(){EV.listen("list-selected",c);EV.listen("lists-loaded",i);EV.listen("list-renamed",u);EV.listen("list-removed",p);EV.listen("list-not-found",p);r.btnSync.on("click",l);r.btnNewList.on("click",n);var y=r.actionChooser[0].querySelectorAll("button");for(var x=0;x<y.length;x++){y[x].addEventListener("click",s)}r.btnBack.on("click",w);r.btnOk.on("click",k)}function l(){if(!FT.isOnline()){utils.status.show("You are offline, how do you suppose to synchronize? :)",3000);return}FT.stopAutoFetch();FT.preventStartupSync();FT.loadAll()}function n(){if(!FT.isOnline()){utils.status.show("You are offline.\nUnfortunately, Fire Tasks is unable to create lists in offline mode at the moment :(",4000);return}o("CREATE",{})}function f(){var x={id:j.id,name:j.title};o("UPDATE",x)}function d(){var y=j;if(y.title==="Uncategorized"){utils.status.show("You cannot delete default list",1500);return}var x={h1:"Delete List",p:"Do you want to delete the list '"+y.title+"'? This cannot be undone.",cancel:"Cancel",ok:"Delete",action:function(){List.deleteList(y.id)}};FT.confirm(x)}function o(y,x){if(y==="CREATE"){x.ok=t.LBL_CREATE;x.h1="Create Task List";x.name=x.name||""}if(y==="UPDATE"){x.ok=t.LBL_UPDATE;x.h1="Rename Task List"}r.form.find("h1").html(x.h1);r.form.find("#btn-list-form-ok").html(x.ok)[0].dataset.id=x.id;r.form.find('input[name="list_name"]').val(x.name);m()}function m(){r.form.removeClass("fade-out").addClass("fade-in");FT.stopAutoFetch()}function w(){r.form.removeClass("fade-in").addClass("fade-out");FT.setAutoFetch()}function k(){var y=e(this).text(),x=r.form.find('input[name="list_name"]'),z=x.val(),A=this.dataset.id;w();if(z.trim()!=""){if(y===t.LBL_CREATE){List.createList(z)}if(y===t.LBL_UPDATE&&j.title!=z){List.renameList(A,z)}}}function v(z){var y=document.createElement("a"),x=document.createElement("li");y.dataset.id=z.id;y.classList.add("prevent-default");y.setAttribute("draggable","false");y.setAttribute("oncontextmenu","return(false);");y.innerHTML=z.title;if(z.selected){y.classList.add("list-selected")}Longpress.bindLongPressHandler(y,400,a,b);x.classList.add("list-item");x.appendChild(y);return x}function i(x){var z=r.list[0];z.innerHTML="";x.forEach(function(A){z.appendChild(v(A))});for(var y=0;y<4;y++){z.appendChild(document.createElement("br"))}List.view.toggleProgress(false);EV.fire("lists-rendered")}function h(y){var x=null;r.list.find("a").each(function(z,A){if(e(A).text().toLowerCase()>y.toLowerCase()){return false}else{x=A.parentNode;return true}});return x}function u(z){try{if(List.getLastActive().id===z.id){z.selected=true}var B=r.list.find('a[data-id="'+z.id+'"]').parent("li")[0],y=v(z),x=h(e(y).find("a").text());B.parentNode.replaceChild(y,B);if(x==B){return}if(x){y.parentNode.insertBefore(y,x.nextSibling)}else{y.parentNode.insertBefore(y,y.parentNode.firstChild)}}catch(A){Logger.log(A)}}function p(x){e(".list-item").find('a[data-id="'+x+'"]').slideUp(function(){e(this).remove()})}function c(y){var x=e('section[data-type="sidebar"] a[data-id="'+y.id+'"]');e('section[data-type="sidebar"] .list-selected').removeClass("list-selected");x.addClass("list-selected")}function b(x){var y=x.target.dataset.id;List.storage.get(y,function(z){if(z){Task.loadData(z);FT.toggleSidebar()}})}function a(y){var x=y.currentTarget;List.storage.get(x.dataset.id,function(z){j=z;r.actionChooser.find("header")[0].innerHTML=z.title;r.btnDeleteList[0].disabled=z.title==="Uncategorized";r.actionChooser.removeClass("fade-out").addClass("fade-in")})}function q(){r.actionChooser.removeClass("fade-in").addClass("fade-out")}function s(x){switch(x.target.id){case r.btnRenameList[0].id:f(x);break;case r.btnDeleteList[0].id:d();break}x.preventDefault();q()}g();return{toggleProgress:function(x){r.btnSync.prop("disabled",x);r.btnNewList.prop("disabled",x);if(x){r.progressBar.show()}else{r.progressBar.hide();FT.setAutoFetch()}},getActionChooserList:function(){return j},getListEl:function(){return r.list}}}(jQuery))};