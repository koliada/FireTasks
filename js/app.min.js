window.App=(function(f){var e="0.5.6",j={MAIN_QUEUE:"mainQueue"},g={LIST:"list",TASK:"task"},k=null,c=[],r;function h(){EV.listen("options-saved",l);EV.listen("lists-loaded",function(){if(!(localStorage.getItem("instructionalOverlayShown")==="true")){App.showInstructionalOverlay();localStorage.setItem("instructionalOverlayShown",true)}});f(document).on("click",".prevent-default",function(t){t.preventDefault()});f(document).on("click",'button[type="reset"]',function(t){t.preventDefault();f(this).siblings('input[type="text"]').first().val("")});f('section[data-type="list"], form').find("a").click(function(){var t=f(this).find('input[type="checkbox"]');App.switchCheckbox(t)});f('section[data-type="sidebar"]').click(function(){EditMode.disable()})}function s(){window.applicationCache.addEventListener("updateready",function(t){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE||window.applicationCache.status==window.applicationCache.UNCACHED){localStorage.setItem("whatsNewShown",false);localStorage.setItem("instructionalOverlayShown",false);if(confirm("A new version of Fire Tasks was downloaded. Apply update now?")){window.location.reload()}}else{}},false);window.applicationCache.addEventListener("error",function(){utils.status.show("A cache error occurred")})}function n(){var t=localStorage.getItem("whatsNewShown");if(!(t==="true")){f.get("WHATSNEW",function(u){alert(u);localStorage.setItem("whatsNewShown",true)})}}function d(){App.options.scope="https://www.googleapis.com/auth/tasks https://www.googleapis.com/auth/userinfo.email";App.options.redirect_uri=document.location.protocol+"//"+document.location.host+document.location.pathname}function p(t){window.Logger=(function(w){var u=0,v=function(){};switch(w){case"ERROR":u=1;break;case"WARNING":u=2;break;case"INFO":u=3;break;default:u=0}return{log:function(){console.log.apply(console,arguments)},info:function(){(u>=3)?console.info.apply(console,arguments):v()},warn:function(){(u>=2)?console.warn.apply(console,arguments):v()},error:function(){(u===1)?console.error.apply(console,arguments):v()}}}(t))}function m(){localforage.setDriver("asyncStorage")}function i(){Sync.setStorageVariable("syncQueue");Sync.setLogLevel("ERROR");Sync.action.setDefaultHandler(Auth.makeRequest);Sync.action(j.MAIN_QUEUE,null).onStart(function(){Task.view.toggleProgress(true)}).onFinish(function(){Task.view.toggleProgress(false)});a();Sync.onError=function(t){if(t.eventName=="Sync.start"&&t.message=="Task failed"){o(t)}};App.startSyncQueue()}function q(){if(window.chrome){var A="Fire tasks beta",t="font-family: Arial",y="font-size: 10px; padding: 26px 0; line-height: 60px",w=window.location.href.replace("app.html","").replace("#","").replace("?",""),v=w+"/images/icons/icon-64.png",z="background-image: url('"+v+"')",u="color: transparent",x=[t,y,z,u].join("; ");console.log("%c"+A,x)}}function a(){var t=setInterval(function(){if(c.length>=3){clearInterval(t);r=true;Sync.pause(j.MAIN_QUEUE);Sync.clearStorage();List.pauseSync();var u=new Blob([JSON.stringify(c)],{type:"text/plain"}),v=window.URL.createObjectURL(u),w={h1:"Error occurred",p:'An unrecoverable synchronization error has occurred. <span class="claim">Please</span> download debug data and contact developer.<br />							No sensitive data included.<br />							<ul class="unrecoverable-error-dialog">								<li><a href="'+v+'" download="firetasks-dump.txt">Download dump</a></li>								<li><a href="mailto:alex.fiator@gmail.com?subject=Fire Tasks Bug Report&body=<Please add some details>" target="_blank">Compose Email</a></li>							</ul>',cancel:"Cancel",ok:"Restart Fire Tasks",recommend:true,hideCancel:true,action:function(){location.reload()}};App.confirm(w);return false}c=[]},2000)}function o(t){delete t.debugData.task.data.pack;delete t.debugData.storedTasks;c.push(t)}function b(){var w=f("#instructional-overlay")[0],u=w.querySelector("canvas"),C=u.getContext("2d"),B="show-tasks-actions",x={list:"LIST",task:"TASK"};function y(E){var D=(E===x.list)?List.view.getListEl()[0]:Task.view.getListEl()[0];var F=D.getBoundingClientRect();return{x:F.left,y:F.top}}function t(){App.toggleSidebar(true);w.classList.remove("fade-in");u.classList.remove(B);w.classList.add("fade-out");w.removeEventListener("click",t)}function v(){App.toggleSidebar(true);w.classList.remove("fade-out");w.classList.add("fade-in")}function A(I){var D=y(I),G=8,K=D.x+G+((I===x.list)?120:160),J=D.y+G+((I===x.list)?14:22),F=80,N={x:K+F,y:J},H=36,M={x:N.x,y:N.y+H},O=20,E={x:M.x-180,y:M.y+O+6},L=(I===x.list)?"Tap & hold to get list actions":"Tap & hold to enter Edit Mode";C.beginPath();C.arc(K,J,G,0,Math.PI*2);C.lineTo(N.x,N.y);C.lineTo(M.x,M.y);C.lineWidth=2;C.strokeStyle="#FFF";C.lineJoin="round";C.font=O+"px FiraSans";C.fillStyle="#FFF";C.fillText(L,E.x,E.y);C.stroke()}function z(){A(x.task);App.toggleSidebar(false);u.classList.add(B);w.addEventListener("click",t);w.removeEventListener("click",z)}if(App.getBodySize().width>=1280){w.addEventListener("click",t)}else{w.addEventListener("click",z)}A(x.list);v()}function l(){App.setAutoFetch();App.setSidebarAnimation()}return{version:e,getEntityTypes:function(){return g},options:{auth_uri:"https://accounts.google.com/o/oauth2/auth",token_uri:"https://accounts.google.com/o/oauth2/token",client_email:"478318582842-6rkd630981kdibb868512f5cll4eg1tj@developer.gserviceaccount.com",redirect_uris:["http://koliada.github.io/FireTasks/app.html"],client_x509_cert_url:"https://www.googleapis.com/robot/v1/metadata/x509/478318582842-6rkd630981kdibb868512f5cll4eg1tj@developer.gserviceaccount.com",client_id:"478318582842-6rkd630981kdibb868512f5cll4eg1tj.apps.googleusercontent.com",auth_provider_x509_cert_url:"https://www.googleapis.com/oauth2/v1/certs"},init:function(){App.toggleSidebar();App.setSidebarAnimation();q();s();n();p("ERROR");d();m();i();h();List.init();Task.init();EditMode.init();Settings.init();List.loadData()},setAutoFetch:function(t){t=t||Settings.get("syncInterval");if(t===0){App.stopAutoFetch();Logger.info("Automatic local data refresh won't start because of the settings");return}if(k||!t){return}Logger.info("Auto fetch started, timeout "+t+" seconds");k=setInterval(function(){Logger.info("Automatic reload initiated");List.getList()},t*1000)},stopAutoFetch:function(){if(k){clearInterval(k);k=null;Logger.info("Auto fetch disabled");return true}return false},addSyncTask:function(t){Sync.task({actionName:j.MAIN_QUEUE,data:t})},startSyncQueue:function(){Sync.start(j.MAIN_QUEUE)},runSetup:function(){var v=f("#setup"),y=v.find("span.description").first(),A=y.html(),x=v.find("progress").first(),u=v.find('span[role="status"] span'),t=f("#btn-start-import"),w=t.html();function z(B){List.storage.set(B,function(){y.html("Successful!");App.toggleSidebar(true);t.html("Go to app").prop("disabled",false).off().on("click",function(){List.loadData();v.removeClass().addClass("fade-out");b();y.html(A);x.val(0);u.html("0");t.html(w)})})}App.toggleSidebar();List.preventOnLoadRefresh();App.stopAutoFetch();v.removeClass().addClass("fade-in");t.prop("disabled",false);t.off().on("click",function(){t.prop("disabled",true);x.addClass("pack-activity");y.html("loading lists...");List.getList(function(C){x.removeClass("pack-activity");if(C.length>0){var E=100/C.length,B=0;y.html("loading tasks...");for(var D=0;D<C.length;D++){(function(F){Task.getList(C[F],function(G,H){C[F].tasks=H;B+=E;x.val(B);u.html(B.toFixed(0));if(B>=100){z(C)}},false)}(D))}}})})},onResourceNotFound:function(t){if(!t){return}switch(t.type){case App.getEntityTypes().LIST:utils.status.show("List not found");EV.fire("list-not-found",t.id);break;case App.getEntityTypes().TASK:utils.status.show("Task not found");EV.fire("task-not-found",t.id);break;default:utils.status.show("Resource not found")}},unrecoverableErrorOccurred:function(){return r||false},confirm:function(u){var t=f("#confirm");t.find("h1").html(u.h1);t.find("p").html(u.p);t.find("#btn-confirm-cancel").html(u.cancel);t.find("#btn-confirm-ok").html(u.ok);if(u.recommend){t.find("#btn-confirm-ok").removeClass("danger").addClass("recommend")}else{t.find("#btn-confirm-ok").removeClass("recommend").addClass("danger")}if(u.hideCancel){t.find("form").first().append(t.find("#btn-confirm-cancel").hide())}else{t.find("#btn-confirm-ok").parent("menu").prepend(t.find("#btn-confirm-cancel").show())}t.removeClass().addClass("fade-in");t.unbind("click").on("click","#btn-confirm-cancel",function(){t.removeClass().addClass("fade-out")}).on("click","#btn-confirm-ok",function(){t.removeClass().addClass("fade-out");u.action()})},switchCheckbox:function(t){var u=t.prop("checked");t.prop("checked",(u===false));t.change()},isFFOS:("mozApps" in navigator&&navigator.userAgent.search("Mobile")!=-1),showInDevelopmentTooltip:function(t){t=t||1000;utils.status.show("This feature is in development",t)},toggleSidebar:function(t){if(t&&location.hash.indexOf("drawer")===-1){location.hash="drawer"}else{if(!t){location.hash=""}}},setSidebarAnimation:function(){},getVersionInteger:function(){return parseInt(App.version.replace(/\./g,""))},showInstructionalOverlay:b,getBodySize:function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0}}}}(jQuery));(function(){App.init()}());(function(d,e,j,h,f,c,b){d.GoogleAnalyticsObject=f;d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},d[f].l=1*new Date();c=e.createElement(j),b=e.getElementsByTagName(j)[0];c.async=1;c.src=h;b.parentNode.insertBefore(c,b)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-18750158-8","koliada.github.io");ga("send","pageview");