window.FT=(function(f){var e="0.6.0",w="http://koliada.github.io/FireTasks/manifest.webapp",k={MAIN_QUEUE:"mainQueue"},g={LIST:"list",TASK:"task"},t=false,j=true,l=null,c=[],u;function h(){EV.listen("options-saved",n);EV.listen("lists-loaded",function(){if(!(localStorage.getItem("instructionalOverlayShown")==="true")){FT.showInstructionalOverlay();localStorage.setItem("instructionalOverlayShown",true)}});EV.listen("tasks-loaded",function(){if(!Settings.get("syncOnStart")){Logger.info("onStart refresh won't start because of the setting");return}if(!FT.isOnline()){Logger.info("onStart refresh won't start immediately because internet connection is offline. Waiting for connection restore");EV.listen("connection-online",function(){x()});return}if(!t){x()}function x(){t=true;FT.loadAll()}});window.addEventListener("online",function(x){Logger.info("Connection is ONLINE");m(true);EV.fire("connection-online")},false);window.addEventListener("offline",function(x){Logger.info("Connection is OFFLINE");m(false);EV.fire("connection-offline")},false);f(document).on("click",".prevent-default",function(x){x.preventDefault()});f("form").on("submit",function(x){x.preventDefault()});f(document).on("click",'button[type="reset"]',function(x){x.preventDefault();f(this).siblings('input[type="text"]').first().val("")});f('section[data-type="list"], form').find("a").click(function(){var x=f(this).find('input[type="checkbox"]');FT.switchCheckbox(x)});f('section[data-type="sidebar"]').click(function(){EditMode.disable()})}function m(x){j=x||window.navigator.onLine}function v(x){window.applicationCache.addEventListener("updateready",function(y){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE||window.applicationCache.status==window.applicationCache.UNCACHED){localStorage.setItem("whatsNewShown",false);localStorage.setItem("instructionalOverlayShown",false);if(confirm("A new version of Fire Tasks was downloaded. Apply update now?")){window.location.reload()}}else{}},false);window.applicationCache.addEventListener("error",function(){utils.status.show("A cache error occurred")})}function p(){var x=localStorage.getItem("whatsNewShown");if(!(x==="true")){f.get("WHATSNEW",function(y){alert(y);localStorage.setItem("whatsNewShown",true)},"html")}}function d(){FT.options.scope="https://www.googleapis.com/auth/tasks https://www.googleapis.com/auth/userinfo.email";FT.options.redirect_uri=document.location.protocol+"//"+document.location.host+document.location.pathname}function r(x){window.Logger=(function(A){var y=0,z=function(){};switch(A){case"ERROR":y=1;break;case"WARNING":y=2;break;case"INFO":y=3;break;default:y=0}return{log:function(){console.log.apply(console,arguments)},info:function(){(y>=3)?console.info.apply(console,arguments):z()},warn:function(){(y>=2)?console.warn.apply(console,arguments):z()},error:function(){(y===1)?console.error.apply(console,arguments):z()},getLevel:function(){return A}}}(x))}function o(){localforage.setDriver("asyncStorage")}function i(){Sync.setStorageVariable("syncQueue");Sync.setLogLevel("ERROR");Sync.action.setDefaultHandler(Auth.makeRequest);Sync.action(k.MAIN_QUEUE,null).onStart(function(){Task.view.toggleProgress(true)}).onFinish(function(){Task.view.toggleProgress(false)});a();Sync.onError=function(x){if(x.eventName=="Sync.start"&&x.message=="Task failed"){q(x)}};FT.startSyncQueue()}function s(){if(window.chrome){var E="Fire tasks beta",x="font-family: Arial",C="font-size: 10px; padding: 26px 0; line-height: 60px",A=window.location.href.replace("app.html","").replace("#","").replace("?",""),z=A+"/images/icons/icon-64.png",D="background-image: url('"+z+"')",y="color: transparent",B=[x,C,D,y].join("; ");console.log("%c"+E,B)}console.info("Thanks for your interest in Fire Tasks! For any details please refer to https://github.com/koliada/FireTasks")}function a(){var x=setInterval(function(){if(c.length>=3){clearInterval(x);u=true;Sync.pause(k.MAIN_QUEUE);Sync.clearStorage();List.pauseSync();var y=new Blob([JSON.stringify(c)],{type:"text/plain"}),z=window.URL.createObjectURL(y),A={h1:"Error occurred",p:'An unrecoverable synchronization error has occurred. <span class="claim">Please</span> download debug data and contact developer.<br />							No sensitive data included.<br />							<ul class="unrecoverable-error-dialog">								<li><a href="'+z+'" download="firetasks-dump.txt">Download dump</a></li>								<li><a href="mailto:alex.fiator@gmail.com?subject=Fire Tasks Bug Report&body=<Please add some details>" target="_blank">Compose Email</a></li>							</ul>',cancel:"Cancel",ok:"Restart Fire Tasks",recommend:true,hideCancel:true,action:function(){location.reload()}};FT.confirm(A);return false}c=[]},2000)}function q(x){delete x.debugData.task.data.pack;delete x.debugData.storedTasks;c.push(x)}function b(){var A=f("#instructional-overlay")[0],y=A.querySelector("canvas"),G=y.getContext("2d"),F="show-tasks-actions",B={list:"LIST",task:"TASK"};function C(I){var H=(I===B.list)?List.view.getListEl()[0]:Task.view.getListEl()[0];var J=H.getBoundingClientRect();return{x:J.left,y:J.top}}function x(){FT.toggleSidebar(true);A.classList.remove("fade-in");y.classList.remove(F);A.classList.add("fade-out");A.removeEventListener("click",x)}function z(){FT.toggleSidebar(true);A.classList.remove("fade-out");A.classList.add("fade-in")}function E(M){var H=C(M),K=8,O=H.x+K+((M===B.list)?120:160),N=H.y+K+((M===B.list)?14:22),J=80,R={x:O+J,y:N},L=36,Q={x:R.x,y:R.y+L},S=20,I={x:Q.x-180,y:Q.y+S+6},P=(M===B.list)?"Tap & hold to get list actions":"Tap & hold to enter Edit Mode";G.beginPath();G.arc(O,N,K,0,Math.PI*2);G.lineTo(R.x,R.y);G.lineTo(Q.x,Q.y);G.lineWidth=2;G.strokeStyle="#FFF";G.lineJoin="round";G.font=S+"px FiraSans";G.fillStyle="#FFF";G.fillText(P,I.x,I.y);G.stroke()}function D(){E(B.task);FT.toggleSidebar(false);y.classList.add(F);A.addEventListener("click",x);A.removeEventListener("click",D)}if(FT.getBodySize().width>=1280){A.addEventListener("click",x)}else{A.addEventListener("click",D)}E(B.list);z()}function n(){FT.setAutoFetch();FT.setSidebarAnimation()}return{getVersion:function(){return e},getEntityTypes:function(){return g},install:function(){if(FT.isFFOS){var x=navigator.mozApps.install(FT.getManifestUrl());x.onsuccess=function(){};x.onerror=function(){alert("Installation failed: "+this.error.name)}}else{window.location.href="app.html#"}},options:{auth_uri:"https://accounts.google.com/o/oauth2/auth",token_uri:"https://accounts.google.com/o/oauth2/token",client_email:"478318582842-6rkd630981kdibb868512f5cll4eg1tj@developer.gserviceaccount.com",redirect_uris:["http://koliada.github.io/FireTasks/app.html"],client_x509_cert_url:"https://www.googleapis.com/robot/v1/metadata/x509/478318582842-6rkd630981kdibb868512f5cll4eg1tj@developer.gserviceaccount.com",client_id:"478318582842-6rkd630981kdibb868512f5cll4eg1tj.apps.googleusercontent.com",auth_provider_x509_cert_url:"https://www.googleapis.com/oauth2/v1/certs"},init:function(){FT.toggleSidebar();FT.setSidebarAnimation();m();s();v();p();r("ERROR");d();o();i();h();Auth.init();List.init();Task.init();EditMode.init();Settings.init();List.loadData()},setAutoFetch:function(x){x=x||Settings.get("syncInterval");if(x===0){FT.stopAutoFetch();Logger.info("Automatic local data refresh won't start because of the settings");return}if(l||!x){return}Logger.info("Auto fetch started, timeout "+x+" seconds");l=setInterval(function(){if(!FT.isOnline()){Logger.info("Automatic reload skipped because of offline mode");return}Logger.info("Automatic reload initiated");List.getList()},x*1000)},stopAutoFetch:function(){if(l){clearInterval(l);l=null;Logger.info("Auto fetch disabled");return true}return false},preventStartupSync:function(){Logger.info("Startup sync prevented");t=true},addSyncTask:function(x){Sync.task({actionName:k.MAIN_QUEUE,data:x})},startSyncQueue:function(){Sync.start(k.MAIN_QUEUE)},runSetup:function(){var z=f("#setup"),C=z.find("span.description").first(),E=C.html(),B=z.find("progress").first(),y=z.find('span[role="status"] span'),x=f("#btn-start-import"),A=x.html();function D(F){List.storage.set(F,function(){C.html("Successful!");FT.toggleSidebar(true);x.html("Go to app").prop("disabled",false).off().on("click",function(){List.loadData();z.removeClass().addClass("fade-out");b();C.html(E);B.val(0);y.html("0");x.html(A)})})}FT.toggleSidebar();FT.preventStartupSync();FT.stopAutoFetch();z.removeClass().addClass("fade-in");x.prop("disabled",false);x.off().on("click",function(){x.prop("disabled",true);B.addClass("pack-activity");C.html("loading lists...");List.getList(function(G){B.removeClass("pack-activity");if(G.length>0){var I=100/G.length,F=0;C.html("loading tasks...");for(var H=0;H<G.length;H++){(function(J){Task.getList(G[J],function(K,L){G[J].tasks=L;F+=I;B.val(F);y.html(F.toFixed(0));if(F>=100){D(G)}},false)}(H))}}})})},loadAll:function(z){var y=0,x=(new Date()).getTime();Logger.info("loadAll(): synchronization started");FT.stopAutoFetch();Auth.dataCalculation.start();List.getList(function(A){EV.fire("lists-loaded",A);if(A.length>0){for(var B=0;B<A.length;B++){(function(C){Task.getList(A[C],function(D,E){A[C].tasks=E;if(y++===A.length-1){List.view.toggleProgress(false);Task.view.toggleProgress(false);List.storage.set(A,function(){Logger.info("loadAll(): synchronization completed, time: "+((new Date()).getTime()-x).toString()+" ms, data transferred: "+Auth.dataCalculation.getValue()+" bytes");Task.view.getListEl().sortable("destroy");var F=List.getLastActive();delete F.tasks;Task.loadData(F);z&&z(A)})}},false)}(B))}}})},onResourceNotFound:function(x){if(!x){return}switch(x.type){case FT.getEntityTypes().LIST:EV.fire("list-not-found",x.id);break;case FT.getEntityTypes().TASK:List.getById(x.listId,function(y){if(y){EV.fire("task-not-found",x.id)}});break;default:utils.status.show("Resource not found")}},unrecoverableErrorOccurred:function(){return u||false},confirm:function(y){var x=f("#confirm");x.find("h1").html(y.h1);x.find("p").html(y.p);x.find("#btn-confirm-cancel").html(y.cancel);x.find("#btn-confirm-ok").html(y.ok);if(y.recommend){x.find("#btn-confirm-ok").removeClass("danger").addClass("recommend")}else{x.find("#btn-confirm-ok").removeClass("recommend").addClass("danger")}if(y.hideCancel){x.find("form").first().append(x.find("#btn-confirm-cancel").hide())}else{x.find("#btn-confirm-ok").parent("menu").prepend(x.find("#btn-confirm-cancel").show())}x.removeClass().addClass("fade-in");x.unbind("click").on("click","#btn-confirm-cancel",function(){x.removeClass().addClass("fade-out")}).on("click","#btn-confirm-ok",function(){x.removeClass().addClass("fade-out");y.action()})},switchCheckbox:function(x){var y=x.prop("checked");x.prop("checked",(y===false));x.change()},isFFOS:("mozApps" in navigator&&navigator.userAgent.search("Mobile")!=-1),showInDevelopmentTooltip:function(x){x=x||1000;utils.status.show("This feature is in development",x)},toggleSidebar:function(x){if(x&&location.hash.indexOf("drawer")===-1){location.hash="drawer"}else{if(!x){location.hash=""}}},setSidebarAnimation:function(){},getVersionInteger:function(x){x=x||FT.getVersion();return parseInt(x.replace(/\./g,""))},getManifestUrl:function(){return w},isOnline:function(){return j},showInstructionalOverlay:b,getBodySize:function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0}}}}(jQuery));(function(){if(location.pathname.indexOf("app.html")===-1){FT.install();return}utils.status.init();FT.init()}());(function(d,e,j,h,f,c,b){d.GoogleAnalyticsObject=f;d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},d[f].l=1*new Date();c=e.createElement(j),b=e.getElementsByTagName(j)[0];c.async=1;c.src=h;b.parentNode.insertBefore(c,b)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-18750158-8","koliada.github.io");ga("send","pageview");