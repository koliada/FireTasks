window.FT=(function(g){var f="0.7.0",z=true,y=z?"http://dev.alex-koliada.com/FireTasks/manifest.webapp":"http://koliada.github.io/FireTasks/manifest.webapp",l={MAIN_QUEUE:"mainQueue"},h={LIST:"list",TASK:"task"},u=false,k=true,m=null,d=[],v;function i(){EV.listen("options-saved",o);EV.listen("tasks-rendered",function(){b();w()});window.addEventListener("online",function(A){Logger.info("Connection is ONLINE");n(true);EV.fire("connection-online")},false);window.addEventListener("offline",function(A){Logger.info("Connection is OFFLINE");n(false);EV.fire("connection-offline")},false);g(document).on("click",".prevent-default",function(A){A.preventDefault()});g("form").on("submit",function(A){A.preventDefault()});g(document).on("click",'button[type="reset"]',function(A){A.preventDefault();g(this).siblings('input[type="text"]').first().val("")});g('section[data-type="list"], form').find("a").click(function(){var A=g(this).find('input[type="checkbox"]');FT.switchCheckbox(A)});g('section[data-type="sidebar"]').click(function(){EditMode.disable()})}function b(){if(!(localStorage.getItem("instructionalOverlayShown")==="true")){FT.showInstructionalOverlay();localStorage.setItem("instructionalOverlayShown",true)}}function w(){if(!Settings.get("syncOnStart")){Logger.info("onStart refresh won't start because of the setting");return}if(!FT.isOnline()){Logger.info("onStart refresh won't start immediately because internet connection is offline. Waiting for connection restore");EV.listen("connection-online",function(){A()});return}if(!u){A()}function A(){u=true;FT.loadAll()}}function n(A){k=A||window.navigator.onLine}function x(A){window.applicationCache.addEventListener("updateready",function(B){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE||window.applicationCache.status==window.applicationCache.UNCACHED){localStorage.setItem("whatsNewShown",false);localStorage.setItem("instructionalOverlayShown",false);if(confirm("A new version of Fire Tasks was downloaded. Apply update now?")){window.location.reload()}}else{}},false);window.applicationCache.addEventListener("error",function(){utils.status.show("A cache error occurred")})}function q(){var A=localStorage.getItem("whatsNewShown");if(!(A==="true")){g.get("WHATSNEW",function(B){alert(B);localStorage.setItem("whatsNewShown",true)},"html")}}function e(){FT.options.scope="https://www.googleapis.com/auth/tasks https://www.googleapis.com/auth/userinfo.email";FT.options.redirect_uri=document.location.protocol+"//"+document.location.host+document.location.pathname}function s(A){if(["ERROR","WARNING","INFO"].indexOf(A)===-1){throw ("Logger.setLevel(): wrong logging level, expected values: ERROR|WARNING|INFO")}window.Logger=(function(D){var B=0,C=function(){};switch(D){case"ERROR":B=1;break;case"WARNING":B=2;break;case"INFO":B=3;break;default:B=0}return{log:function(){console.log.apply(console,arguments)},info:function(){(B>=3)?console.info.apply(console,arguments):C()},warn:function(){(B>=2)?console.warn.apply(console,arguments):C()},error:function(){(B===1)?console.error.apply(console,arguments):C()},getLevel:function(){return D},setLevel:s}}(A));return window.Logger}function p(){localforage.setDriver("asyncStorage")}function j(){Sync.setStorageVariable("syncQueue");Sync.setLogLevel("ERROR");Sync.action.setDefaultHandler(Auth.makeRequest);Sync.action(l.MAIN_QUEUE,null).onStart(function(){Task.view.toggleProgress(true)}).onFinish(function(){Task.view.toggleProgress(false)});a();Sync.onError=function(A){if(A.eventName=="Sync.start"&&A.message=="Task failed"){r(A)}};FT.startSyncQueue()}function t(){if(window.chrome){var H="Fire tasks beta",A="font-family: Arial",F="font-size: 10px; padding: 26px 0; line-height: 60px",D=window.location.href.replace("app.html","").replace("#","").replace("?",""),C=D+"/images/icons/icon-64.png",G="background-image: url('"+C+"')",B="color: transparent",E=[A,F,G,B].join("; ");console.log("%c"+H,E)}console.info("Thank you for your interest in Fire Tasks! For any details please refer to https://github.com/koliada/FireTasks")}function a(){var A=setInterval(function(){if(d.length>=3){clearInterval(A);v=true;Sync.pause(l.MAIN_QUEUE);Sync.clearStorage();List.pauseSync();var B=new Blob([JSON.stringify(d)],{type:"text/plain"}),C=window.URL.createObjectURL(B),D={h1:"Error occurred",p:'An unrecoverable synchronization error has occurred. <span class="claim">Please</span> download debug data and contact developer.<br />							No sensitive data included.<br />							<ul class="unrecoverable-error-dialog">								<li><a href="'+C+'" download="firetasks-dump.txt">Download dump</a></li>								<li><a href="mailto:alex.fiator@gmail.com?subject=Fire Tasks Bug Report&body=<Please add some details>" target="_blank">Compose Email</a></li>							</ul>',cancel:"Cancel",ok:"Restart Fire Tasks",recommend:true,hideCancel:true,action:function(){location.reload()}};FT.confirm(D);return false}d=[]},2000)}function r(A){delete A.debugData.task.data.pack;delete A.debugData.storedTasks;d.push(A)}function c(){var D=g("#instructional-overlay")[0],B=D.querySelector("canvas"),J=B.getContext("2d"),I="show-tasks-actions",E={list:"LIST",task:"TASK"};function F(L){var K=(L===E.list)?List.view.getListEl()[0]:Task.view.getListEl()[0];var M=K.getBoundingClientRect();return{x:M.left,y:M.top}}function A(){FT.toggleSidebar(true);D.classList.remove("fade-in");B.classList.remove(I);D.classList.add("fade-out");D.removeEventListener("click",A)}function C(){FT.toggleSidebar(true);D.classList.remove("fade-out");D.classList.add("fade-in")}function H(P){var K=F(P),N=8,R=K.x+N+((P===E.list)?120:160),Q=K.y+N+((P===E.list)?14:22),M=80,U={x:R+M,y:Q},O=36,T={x:U.x,y:U.y+O},V=20,L={x:T.x-180,y:T.y+V+6},S=(P===E.list)?"Tap & hold to get list actions":"Tap & hold to enter Edit Mode";J.beginPath();J.arc(R,Q,N,0,Math.PI*2);J.lineTo(U.x,U.y);J.lineTo(T.x,T.y);J.lineWidth=2;J.strokeStyle="#FFF";J.lineJoin="round";J.font=V+"px FiraSans";J.fillStyle="#FFF";J.fillText(S,L.x,L.y);J.stroke()}function G(){H(E.task);FT.toggleSidebar(false);B.classList.add(I);D.addEventListener("click",A);D.removeEventListener("click",G)}if(FT.getBodySize().width>=1280){D.addEventListener("click",A)}else{D.addEventListener("click",G)}H(E.list);C()}function o(){FT.setAutoFetch();FT.setAnimations()}return{getVersion:function(){return f},getEntityTypes:function(){return h},install:function(){if(FT.isFFOS){var A=navigator.mozApps.install(FT.getManifestUrl());A.onsuccess=function(){};A.onerror=function(){alert("Installation failed: "+this.error.name)}}else{window.location.href="app.html#"}},options:{auth_uri:"https://accounts.google.com/o/oauth2/auth",token_uri:"https://accounts.google.com/o/oauth2/token",client_email:"478318582842-6rkd630981kdibb868512f5cll4eg1tj@developer.gserviceaccount.com",redirect_uris:["http://koliada.github.io/FireTasks/app.html"],client_x509_cert_url:"https://www.googleapis.com/robot/v1/metadata/x509/478318582842-6rkd630981kdibb868512f5cll4eg1tj@developer.gserviceaccount.com",client_id:"478318582842-6rkd630981kdibb868512f5cll4eg1tj.apps.googleusercontent.com",auth_provider_x509_cert_url:"https://www.googleapis.com/oauth2/v1/certs"},init:function(){n();t();x();q();s("ERROR");e();p();j();i();FT.toggleSidebar();FT.setAnimations();Auth.init();List.init();Task.init();EditMode.init();Settings.init();List.loadData()},setAutoFetch:function(A){A=A||Settings.get("syncInterval");if(A===0){FT.stopAutoFetch();Logger.info("Automatic local data refresh won't start because of the settings");return}if(m||!A){return}if(A<60){Logger.warn("Delay value should be equal to or greater than 60 (measured in seconds)");return}Logger.info("Auto fetch started, timeout "+A+" seconds");m=setInterval(function(){if(!FT.isOnline()){Logger.info("Automatic reload skipped because of offline mode");return}Logger.info("Automatic reload initiated");List.getList()},A*1000)},stopAutoFetch:function(){if(m){clearInterval(m);m=null;Logger.info("Auto fetch disabled");return true}return false},preventStartupSync:function(){Logger.info("Startup sync prevented");u=true},addSyncTask:function(A){Sync.task({actionName:l.MAIN_QUEUE,data:A})},startSyncQueue:function(){Sync.start(l.MAIN_QUEUE)},runSetup:function(){var C=g("#setup"),F=C.find("span.description").first(),H=F.html(),E=C.find("progress").first(),B=C.find('span[role="status"] span'),A=g("#btn-start-import"),D=A.html();function G(I){List.storage.set(I,function(){F.html("Successful!");FT.toggleSidebar(true);A.html("Go to app").prop("disabled",false).off().on("click",function(){List.loadData();C.removeClass("fade-in").addClass("fade-out");c();F.html(H);E.val(0);B.html("0");A.html(D)})})}FT.toggleSidebar();FT.preventStartupSync();FT.stopAutoFetch();C.removeClass("fade-out").addClass("fade-in");A.prop("disabled",false);A.off().on("click",function(){A.prop("disabled",true);E.addClass("pack-activity");F.html("loading lists...");List.getList(function(J){E.removeClass("pack-activity");if(J.length>0){var L=100/J.length,I=0;F.html("loading tasks...");for(var K=0;K<J.length;K++){(function(M){Task.getList(J[M],function(N,O){J[M].tasks=O;I+=L;E.val(I);B.html(I.toFixed(0));if(I>=100){G(J)}},false)}(K))}}})})},loadAll:function(C){var B=0,A=(new Date()).getTime();Logger.info("loadAll(): synchronization started");FT.stopAutoFetch();Auth.dataCalculation.start();List.getList(function(D){if(D.length>0){for(var E=0;E<D.length;E++){(function(F){Task.getList(D[F],function(G,H){D[F].tasks=H;if(B++===D.length-1){List.view.toggleProgress(false);Task.view.toggleProgress(false);List.storage.set(D,function(){Logger.info("loadAll(): synchronization completed, time: "+((new Date()).getTime()-A).toString()+" ms, data transferred: "+Auth.dataCalculation.getValue()+" bytes");var I=List.getLastActive();delete I.tasks;EV.fire("list-selected",I);EV.fire("lists-loaded",D);C&&C(D)})}},false)}(E))}}})},onResourceNotFound:function(A){if(!A){return}switch(A.type){case FT.getEntityTypes().LIST:EV.fire("list-not-found",A.id);break;case FT.getEntityTypes().TASK:List.getById(A.listId,function(B){if(B){EV.fire("task-not-found",A.id)}});break;default:utils.status.show("Resource not found")}},unrecoverableErrorOccurred:function(){return v||false},confirm:function(B){var A=g("#confirm");A.find("h1").html(B.h1);A.find("p").html(B.p);A.find("#btn-confirm-cancel").html(B.cancel);A.find("#btn-confirm-ok").html(B.ok);if(B.recommend){A.find("#btn-confirm-ok").removeClass("danger").addClass("recommend")}else{A.find("#btn-confirm-ok").removeClass("recommend").addClass("danger")}if(B.hideCancel){A.find("form").first().append(A.find("#btn-confirm-cancel").hide())}else{A.find("#btn-confirm-ok").parent("menu").prepend(A.find("#btn-confirm-cancel").show())}A.removeClass("fade-out").addClass("fade-in");A.unbind("click").on("click","#btn-confirm-cancel",function(){A.removeClass("fade-in").addClass("fade-out")}).on("click","#btn-confirm-ok",function(){A.removeClass("fade-in").addClass("fade-out");B.action&&B.action()})},switchCheckbox:function(A){var B=A.prop("checked");A.prop("checked",(B===false));A.change()},isFFOS:("mozApps" in navigator&&navigator.userAgent.search("Mobile")!=-1),isMozActivityAvailable:typeof MozActivity!=="undefined",showInDevelopmentTooltip:function(A){A=A||1000;utils.status.show("This feature is in development",A)},toggleSidebar:function(A){if(A&&location.hash.indexOf("drawer")===-1){location.hash="drawer"}else{if(!A){location.hash=""}}},setAnimations:function(){var A=Settings.get("noAnimations");if(A===true){document.getElementById("drawer").classList.add("no-animation");g('[data-position="back"]').addClass("no-animation");g('[data-type="edit"]').addClass("no-animation");g("label.pack-switch").addClass("no-animation");Logger.info("setAnimations(): animations suppressing enabled")}else{document.getElementById("drawer").classList.remove("no-animation");g('[data-position="back"]').removeClass("no-animation");g('[data-type="edit"]').removeClass("no-animation");g("label.pack-switch").removeClass("no-animation");Logger.info("setAnimations(): animations suppressing disabled")}},getVersionInteger:function(A){A=A||FT.getVersion();return parseInt(A.replace(/\./g,""))},getManifestUrl:function(){return y},isOnline:function(){return k},showInstructionalOverlay:c,getBodySize:function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0}}}}(jQuery));(function(){if(location.pathname.indexOf("app.html")===-1){FT.install();return}utils.status.init();FT.init()}());(function(d,e,j,h,f,c,b){d.GoogleAnalyticsObject=f;d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},d[f].l=1*new Date();c=e.createElement(j),b=e.getElementsByTagName(j)[0];c.async=1;c.src=h;b.parentNode.insertBefore(c,b)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-18750158-8","koliada.github.io");ga("send","pageview");